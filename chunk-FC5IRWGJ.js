import{$a as C,C as h,L as v,O as d,P as D,R as S,U as R,V as M,W as l,X as I,Za as N,a as T,da as k,e as E,f as y,ia as P,n as p,w as c,x as m}from"./chunk-BNPGFM2V.js";var O="Service workers are disabled or not supported by this browser",g=class{serviceWorker;worker;registration;events;constructor(r,t){if(this.serviceWorker=r,!r)this.worker=this.events=this.registration=new E(n=>n.error(new d(5601,!1)));else{let n=null,e=new y;this.worker=new E(a=>(n!==null&&a.next(n),e.subscribe(w=>a.next(w))));let o=()=>{let{controller:a}=r;a!==null&&(n=a,e.next(n))};r.addEventListener("controllerchange",o),o(),this.registration=this.worker.pipe(v(()=>r.getRegistration().then(a=>{if(!a)throw new d(5601,!1);return a})));let i=new y;this.events=i.asObservable();let u=a=>{let{data:w}=a;w?.type&&i.next(w)};r.addEventListener("message",u),t?.get(C,null,{optional:!0})?.onDestroy(()=>{r.removeEventListener("controllerchange",o),r.removeEventListener("message",u)})}}postMessage(r,t){return new Promise(n=>{this.worker.pipe(h(1)).subscribe(e=>{e.postMessage(T({action:r},t)),n()})})}postMessageWithOperation(r,t,n){let e=this.waitForOperationCompleted(n),o=this.postMessage(r,t);return Promise.all([o,e]).then(([,i])=>i)}generateNonce(){return Math.round(Math.random()*1e7)}eventsOfType(r){let t;return typeof r=="string"?t=n=>n.type===r:t=n=>r.includes(n.type),this.events.pipe(m(t))}nextEventOfType(r){return this.eventsOfType(r).pipe(h(1))}waitForOperationCompleted(r){return new Promise((t,n)=>{this.eventsOfType("OPERATION_COMPLETED").pipe(m(e=>e.nonce===r),h(1),p(e=>{if(e.result!==void 0)return e.result;throw new Error(e.error)})).subscribe({next:t,error:n})})}get isEnabled(){return!!this.serviceWorker}},A=(()=>{class s{sw;messages;notificationClicks;notificationCloses;pushSubscriptionChanges;subscription;get isEnabled(){return this.sw.isEnabled}pushManager=null;subscriptionChanges=new y;constructor(t){if(this.sw=t,!t.isEnabled){this.messages=c,this.notificationClicks=c,this.notificationCloses=c,this.pushSubscriptionChanges=c,this.subscription=c;return}this.messages=this.sw.eventsOfType("PUSH").pipe(p(e=>e.data)),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(p(e=>e.data)),this.notificationCloses=this.sw.eventsOfType("NOTIFICATION_CLOSE").pipe(p(e=>e.data)),this.pushSubscriptionChanges=this.sw.eventsOfType("PUSH_SUBSCRIPTION_CHANGE").pipe(p(e=>e.data)),this.pushManager=this.sw.registration.pipe(p(e=>e.pushManager));let n=this.pushManager.pipe(v(e=>e.getSubscription()));this.subscription=new E(e=>{let o=n.subscribe(e),i=this.subscriptionChanges.subscribe(e);return()=>{o.unsubscribe(),i.unsubscribe()}})}requestSubscription(t){if(!this.sw.isEnabled||this.pushManager===null)return Promise.reject(new Error(O));let n={userVisibleOnly:!0},e=this.decodeBase64(t.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),o=new Uint8Array(new ArrayBuffer(e.length));for(let i=0;i<e.length;i++)o[i]=e.charCodeAt(i);return n.applicationServerKey=o,new Promise((i,u)=>{this.pushManager.pipe(v(f=>f.subscribe(n)),h(1)).subscribe({next:f=>{this.subscriptionChanges.next(f),i(f)},error:u})})}unsubscribe(){if(!this.sw.isEnabled)return Promise.reject(new Error(O));let t=n=>{if(n===null)throw new d(5602,!1);return n.unsubscribe().then(e=>{if(!e)throw new d(5603,!1);this.subscriptionChanges.next(null)})};return new Promise((n,e)=>{this.subscription.pipe(h(1),v(t)).subscribe({next:n,error:e})})}decodeBase64(t){return atob(t)}static \u0275fac=function(n){return new(n||s)(M(g))};static \u0275prov=S({token:s,factory:s.\u0275fac})}return s})(),F=(()=>{class s{sw;versionUpdates;unrecoverable;get isEnabled(){return this.sw.isEnabled}ongoingCheckForUpdate=null;constructor(t){if(this.sw=t,!t.isEnabled){this.versionUpdates=c,this.unrecoverable=c;return}this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY","NO_NEW_VERSION_DETECTED"]),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(O));if(this.ongoingCheckForUpdate)return this.ongoingCheckForUpdate;let t=this.sw.generateNonce();return this.ongoingCheckForUpdate=this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:t},t).finally(()=>{this.ongoingCheckForUpdate=null}),this.ongoingCheckForUpdate}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new d(5601,!1));let t=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:t},t)}static \u0275fac=function(n){return new(n||s)(M(g))};static \u0275prov=S({token:s,factory:s.\u0275fac})}return s})(),U=new R("");function j(){let s=l(b);if(!("serviceWorker"in navigator&&s.enabled!==!1))return;let r=l(U),t=l(P),n=l(C);t.runOutsideAngular(()=>{let e=navigator.serviceWorker,o=()=>e.controller?.postMessage({action:"INITIALIZE"});e.addEventListener("controllerchange",o),n.onDestroy(()=>{e.removeEventListener("controllerchange",o)})}),t.runOutsideAngular(()=>{let e,{registrationStrategy:o}=s;if(typeof o=="function")e=new Promise(i=>o().subscribe(()=>i()));else{let[i,...u]=(o||"registerWhenStable:30000").split(":");switch(i){case"registerImmediately":e=Promise.resolve();break;case"registerWithDelay":e=_(+u[0]||0);break;case"registerWhenStable":e=Promise.race([n.whenStable(),_(+u[0])]);break;default:throw new d(5600,!1)}}e.then(()=>{n.destroyed||navigator.serviceWorker.register(r,{scope:s.scope,updateViaCache:s.updateViaCache,type:s.type}).catch(i=>console.error(D(5604,!1)))})})}function _(s){return new Promise(r=>setTimeout(r,s))}function W(){let s=l(b),r=l(k),t=!0;return new g(t&&s.enabled!==!1?navigator.serviceWorker:void 0,r)}var b=class{enabled;updateViaCache;type;scope;registrationStrategy};function z(s,r={}){return I([A,F,{provide:U,useValue:s},{provide:b,useValue:r},{provide:g,useFactory:W},N(j)])}export{F as a,z as b};
