import{b as $}from"./chunk-VIFWUXH6.js";import{c as J}from"./chunk-HRVLLNZ6.js";import"./chunk-DSZ3W35X.js";import{n as O,r as H,s as G}from"./chunk-EM23FPTW.js";import{$a as D,Ab as _,Bb as R,Eb as W,Ka as p,Mb as Q,Nb as f,P as L,U as g,Ub as q,Wa as d,Xa as m,Ya as M,Z as h,_ as y,_a as j,ab as N,bb as s,cb as l,db as S,eb as x,fb as b,hb as v,ia as c,ib as T,jb as U,kb as k,lb as u,pb as F,qb as V,rb as z,wb as B,xb as K,ya as r,zb as a}from"./chunk-FOB3NPCH.js";var w=class i{async canUseBiometrics(){return!!window.PublicKeyCredential&&await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable()}async registerLocalAuth(t){let e={challenge:Uint8Array.from("random_challenge_string",o=>o.charCodeAt(0)),rp:{name:"My PWA App",id:window.location.hostname},user:{id:Uint8Array.from(t,o=>o.charCodeAt(0)),name:t,displayName:t},pubKeyCredParams:[{alg:-7,type:"public-key"}],authenticatorSelection:{userVerification:"required"},timeout:6e4},n=await navigator.credentials.create({publicKey:e});return localStorage.setItem("local_cred_id",btoa(String.fromCharCode(...new Uint8Array(n.rawId)))),n}async verifyUser(){let t=localStorage.getItem("local_cred_id");if(!t)throw new Error("No registered credential found");let e={challenge:Uint8Array.from("random_login_challenge",n=>n.charCodeAt(0)),allowCredentials:[{id:Uint8Array.from(atob(t),n=>n.charCodeAt(0)),type:"public-key"}],userVerification:"required"};return await navigator.credentials.get({publicKey:e})}static \u0275fac=function(e){return new(e||i)};static \u0275prov=L({token:i,factory:i.\u0275fac,providedIn:"root"})};var ee=["pinInput"],te=()=>[];function ne(i,t){if(i&1&&(x(0,"span",6),a(1),b()),i&2){let e=u().$index,n=u();r(),R(" ",n.mask()?"\u25CF":n.pin()[e]," ")}}function ie(i,t){if(i&1&&(x(0,"div",5),d(1,ne,2,1,"span",6),b()),i&2){let e=t.$index,n=u();K("border-zinc-500",n.pin()[e])("border-outline",!n.pin()[e])("bg-primary/2",n.pin()[e]),r(),m(n.pin()[e]?1:-1)}}var C=class i{length=f(4,{transform:q});mask=f(!0);pinCompleted=Q();pin=c([]);inputElement;onInputChange(t){let e=t.target.value;e.length<=this.length()?(this.pin.set(e.split("")),e.length===this.length()&&this.pinCompleted.emit(e)):t.target.value=e.slice(0,this.length())}onBackspace(){}focusFirstEmpty(){let t=this.inputElement.toArray();t.length>0&&t[0].nativeElement.focus()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=p({type:i,selectors:[["app-input-pin"]],viewQuery:function(e,n){if(e&1&&F(ee,5),e&2){let o;V(o=z())&&(n.inputElement=o)}},inputs:{length:[1,"length"],mask:[1,"mask"]},outputs:{pinCompleted:"pinCompleted"},decls:6,vars:2,consts:[["pinInput",""],[1,"flex","flex-col","items-center","justify-center","gap-6"],[1,"flex","gap-3",3,"click"],[1,"w-12","h-14","border-2","rounded-lg","flex","items-center","justify-center","text-2xl","font-bold","transition-all","duration-200",3,"border-zinc-500","border-outline","bg-primary/2"],["type","number","pattern","\\d*","inputmode","numeric",1,"opacity-0","absolute","-z-10",3,"input","maxLength"],[1,"w-12","h-14","border-2","rounded-lg","flex","items-center","justify-center","text-2xl","font-bold","transition-all","duration-200"],[1,"animate-in","zoom-in","duration-200"]],template:function(e,n){if(e&1){let o=v();x(0,"div",1)(1,"div",2),k("click",function(){return h(o),y(n.focusFirstEmpty())}),j(2,ie,2,7,"div",3,M),b(),x(4,"input",4,0),k("input",function(E){return h(o),y(n.onInputChange(E))}),b()()}e&2&&(r(2),D(W(1,te).constructor(n.length())),r(2),T("maxLength",n.length()))},encapsulation:2})};function oe(i,t){i&1&&(s(0,"span",1),a(1,"location_on"),l())}var I=class i{showIcon=f(!0);maxWidth=f("210px");service=g(J);currentLocation=c("Bantumilli, Krishna, AP ejfaklsdjfalskdjflkasjdf;lkasjdflkajsldfj;asldj;fkjewoiur waoeirjwoqiejkj")();static \u0275fac=function(e){return new(e||i)};static \u0275cmp=p({type:i,selectors:[["app-select-location"]],inputs:{showIcon:[1,"showIcon"],maxWidth:[1,"maxWidth"]},decls:9,vars:4,consts:[["mat-ripple","",1,"flex","items-center","gap-3","px-4","py-2","bg-surface-container-low","hover:bg-surface-container-high","transition-all","cursor-pointer","text-blue-600"],[1,"material-symbols-rounded","text-primary","active"],[1,"flex","flex-col","items-start","text-left","gap-1"],[1,"text-[11px]","font-sans","font-medium","text-secondary","leading-none","uppercase","text-black"],[1,"text-base","font-bold","font-headings","text-primary","truncate"],[1,"material-symbols-rounded","text-secondary","ml-auto"]],template:function(e,n){e&1&&(s(0,"button",0),d(1,oe,2,0,"span",1),s(2,"div",2)(3,"label",3),a(4,"Current Location"),l(),s(5,"span",4),a(6),l()(),s(7,"span",5),a(8,"expand_more"),l()()),e&2&&(r(),m(n.showIcon()?1:-1),r(4),B("max-width",n.maxWidth()),r(),_(n.currentLocation))},dependencies:[H,O],encapsulation:2})};function re(i,t){if(i&1&&(s(0,"p",8),a(1),l()),i&2){let e=u();r(),_(e.errorMessage())}}var Y=class i{bioService=g(w);router=g($);errorMessage=c("");async onPinFilled(t){let n=new TextEncoder().encode(t+"your_app_salt"),o=await window.crypto.subtle.digest("SHA-256",n),E=Array.from(new Uint8Array(o)).map(Z=>Z.toString(16).padStart(2,"0")).join("");localStorage.setItem("user_pin_hash",E)}async handleLogin(){try{await this.bioService.verifyUser(),this.router.navigate(["/app/dashboard"])}catch(t){alert(t),this.errorMessage.set("Authentication failed. Please try again.")}}async setupNew(){try{await this.bioService.registerLocalAuth("User123"),alert("Device registered successfully!")}catch(t){alert(t),this.errorMessage.set("Could not setup biometrics.")}}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=p({type:i,selectors:[["app-login-page"]],decls:14,vars:2,consts:[["pinInput",""],[1,"flex","flex-col","items-center","justify-center","min-h-screen","p-6","bg-surface"],[1,"font-headings","text-3xl","font-bold","mb-2"],[1,"font-sans","text-secondary","mb-12","text-center"],[1,"bg-gray-200","p-8","rounded-full","mb-12"],[1,"fingerprint","material-symbols-rounded","text-6xl","text-primary"],["length","4",3,"mask"],[1,"w-full","py-4","rounded-md","text-lg","font-headings","bg-zinc-800","hover:bg-zinc-600","text-white",3,"click"],[1,"mt-4","text-error","font-sans","text-sm"]],template:function(e,n){if(e&1){let o=v();s(0,"div",1)(1,"h1",2),a(2,"Welcome Back"),l(),s(3,"p",3),a(4,"Unlock your profile using your secure PIN"),l(),s(5,"div",4)(6,"span",5),a(7," lock_open_right "),l()(),S(8,"app-input-pin",6,0),s(10,"button",7),U("click",function(){return h(o),y(n.handleLogin())}),a(11," Unlock App "),l(),d(12,re,2,1,"p",8),S(13,"app-select-location"),l()}e&2&&(r(8),N("mask",!0),r(4),m(n.errorMessage()?12:-1))},dependencies:[G,C,I],styles:['.fingerprint[_ngcontent-%COMP%]{font-size:4.75rem;font-variation-settings:"FILL" 1,"wght" 200,"GRAD" -25,"opsz" 48}']})};export{Y as LoginPage};
