import{c as G}from"./chunk-4QPFTE7O.js";import{b as S,d as T,e as Q}from"./chunk-ZCBN7BYE.js";import{$a as V,H as P,Ia as u,Ja as p,Ka as N,La as k,M as C,Ma as O,Na as F,Oa as s,Pa as l,Qa as E,R as g,Ra as y,S as h,Sa as M,Ta as x,Ua as R,Va as j,Wa as A,Xa as m,Za as U,_a as W,aa as c,ab as Y,bb as $,cb as a,db as w,eb as z,fb as B,kb as H,lb as f,pa as o,qb as K,za as d}from"./chunk-ESC52WEI.js";var _=class i{async canUseBiometrics(){return!!window.PublicKeyCredential&&await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable()}async registerLocalAuth(t){let e={challenge:Uint8Array.from("random_challenge_string",r=>r.charCodeAt(0)),rp:{name:"My PWA App",id:window.location.hostname},user:{id:Uint8Array.from(t,r=>r.charCodeAt(0)),name:t,displayName:t},pubKeyCredParams:[{alg:-7,type:"public-key"}],authenticatorSelection:{userVerification:"required"},timeout:6e4},n=await navigator.credentials.create({publicKey:e});return localStorage.setItem("local_cred_id",btoa(String.fromCharCode(...new Uint8Array(n.rawId)))),n}async verifyUser(){let t=localStorage.getItem("local_cred_id");if(!t)throw new Error("No registered credential found");let e={challenge:Uint8Array.from("random_login_challenge",n=>n.charCodeAt(0)),allowCredentials:[{id:Uint8Array.from(atob(t),n=>n.charCodeAt(0)),type:"public-key"}],userVerification:"required"};return await navigator.credentials.get({publicKey:e})}static \u0275fac=function(e){return new(e||i)};static \u0275prov=P({token:i,factory:i.\u0275fac,providedIn:"root"})};var J=["pinInput"],ee=()=>[];function te(i,t){if(i&1&&(y(0,"span",6),a(1),M()),i&2){let e=m().$index,n=m();o(),z(" ",n.mask()?"\u25CF":n.pin()[e]," ")}}function ne(i,t){if(i&1&&(y(0,"div",5),u(1,te,2,1,"span",6),M()),i&2){let e=t.$index,n=m();$("border-zinc-500",n.pin()[e])("border-outline",!n.pin()[e])("bg-primary/2",n.pin()[e]),o(),p(n.pin()[e]?1:-1)}}var v=class i{length=f(4,{transform:K});mask=f(!0);pinCompleted=H();pin=c([]);inputElement;onInputChange(t){let e=t.target.value;e.length<=this.length()?(this.pin.set(e.split("")),e.length===this.length()&&this.pinCompleted.emit(e)):t.target.value=e.slice(0,this.length())}onBackspace(){}focusFirstEmpty(){let t=this.inputElement.toArray();t.length>0&&t[0].nativeElement.focus()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=d({type:i,selectors:[["app-input-pin"]],viewQuery:function(e,n){if(e&1&&U(J,5),e&2){let r;W(r=V())&&(n.inputElement=r)}},inputs:{length:[1,"length"],mask:[1,"mask"]},outputs:{pinCompleted:"pinCompleted"},decls:6,vars:2,consts:[["pinInput",""],[1,"flex","flex-col","items-center","justify-center","gap-6"],[1,"flex","gap-3",3,"click"],[1,"w-12","h-14","border-2","rounded-lg","flex","items-center","justify-center","text-2xl","font-bold","transition-all","duration-200",3,"border-zinc-500","border-outline","bg-primary/2"],["type","number","pattern","\\d*","inputmode","numeric",1,"opacity-0","absolute","-z-10",3,"input","maxLength"],[1,"w-12","h-14","border-2","rounded-lg","flex","items-center","justify-center","text-2xl","font-bold","transition-all","duration-200"],[1,"animate-in","zoom-in","duration-200"]],template:function(e,n){if(e&1){let r=x();y(0,"div",1)(1,"div",2),A("click",function(){return g(r),h(n.focusFirstEmpty())}),k(2,ne,2,7,"div",3,N),M(),y(4,"input",4,0),A("input",function(I){return g(r),h(n.onInputChange(I))}),M()()}e&2&&(o(2),O(B(1,ee).constructor(n.length())),o(2),R("maxLength",n.length()))},encapsulation:2})};function re(i,t){i&1&&(s(0,"span",1),a(1,"location_on"),l())}var b=class i{showIcon=f(!0);maxWidth=f("210px");currentLocation=c("Bantumilli, Krishna, AP ejfaklsdjfalskdjflkasjdf;lkasjdflkajsldfj;asldj;fkjewoiur waoeirjwoqiejkj")();static \u0275fac=function(e){return new(e||i)};static \u0275cmp=d({type:i,selectors:[["app-select-location"]],inputs:{showIcon:[1,"showIcon"],maxWidth:[1,"maxWidth"]},decls:9,vars:4,consts:[["mat-ripple","",1,"flex","items-center","gap-3","px-4","py-2","bg-surface-container-low","hover:bg-surface-container-high","transition-all","cursor-pointer","text-blue-600"],[1,"material-symbols-rounded","text-primary","active"],[1,"flex","flex-col","items-start","text-left","gap-1"],[1,"text-[11px]","font-sans","font-medium","text-secondary","leading-none","uppercase","text-black"],[1,"text-base","font-bold","font-headings","text-primary","truncate"],[1,"material-symbols-rounded","text-secondary","ml-auto"]],template:function(e,n){e&1&&(s(0,"button",0),u(1,re,2,0,"span",1),s(2,"div",2)(3,"label",3),a(4,"Current Location"),l(),s(5,"span",4),a(6),l()(),s(7,"span",5),a(8,"expand_more"),l()()),e&2&&(o(),p(n.showIcon()?1:-1),o(4),Y("max-width",n.maxWidth()),o(),w(n.currentLocation))},dependencies:[T,S],encapsulation:2})};function oe(i,t){if(i&1&&(s(0,"p",8),a(1),l()),i&2){let e=m();o(),w(e.errorMessage())}}var q=class i{bioService=C(_);router=C(G);errorMessage=c("");async onPinFilled(t){let n=new TextEncoder().encode(t+"your_app_salt"),r=await window.crypto.subtle.digest("SHA-256",n),I=Array.from(new Uint8Array(r)).map(X=>X.toString(16).padStart(2,"0")).join("");localStorage.setItem("user_pin_hash",I)}async handleLogin(){try{await this.bioService.verifyUser(),this.router.navigate(["/app/dashboard"])}catch(t){alert(t),this.errorMessage.set("Authentication failed. Please try again.")}}async setupNew(){try{await this.bioService.registerLocalAuth("User123"),alert("Device registered successfully!")}catch(t){alert(t),this.errorMessage.set("Could not setup biometrics.")}}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=d({type:i,selectors:[["app-login-page"]],decls:14,vars:2,consts:[["pinInput",""],[1,"flex","flex-col","items-center","justify-center","min-h-screen","p-6","bg-surface"],[1,"font-headings","text-3xl","font-bold","mb-2"],[1,"font-sans","text-secondary","mb-12","text-center"],[1,"bg-gray-200","p-8","rounded-full","mb-12"],[1,"fingerprint","material-symbols-rounded","text-6xl","text-primary"],["length","4",3,"mask"],[1,"w-full","py-4","rounded-md","text-lg","font-headings","bg-zinc-800","hover:bg-zinc-600","text-white",3,"click"],[1,"mt-4","text-error","font-sans","text-sm"]],template:function(e,n){if(e&1){let r=x();s(0,"div",1)(1,"h1",2),a(2,"Welcome Back"),l(),s(3,"p",3),a(4,"Unlock your profile using your secure PIN"),l(),s(5,"div",4)(6,"span",5),a(7," lock_open_right "),l()(),E(8,"app-input-pin",6,0),s(10,"button",7),j("click",function(){return g(r),h(n.handleLogin())}),a(11," Unlock App "),l(),u(12,oe,2,1,"p",8),E(13,"app-select-location"),l()}e&2&&(o(8),F("mask",!0),o(4),p(n.errorMessage()?12:-1))},dependencies:[Q,v,b],styles:['.fingerprint[_ngcontent-%COMP%]{font-size:4.75rem;font-variation-settings:"FILL" 1,"wght" 200,"GRAD" -25,"opsz" 48}']})};export{q as LoginPage};
