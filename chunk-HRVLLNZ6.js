import{Kb as u,P as c,a as s,ia as l}from"./chunk-FOB3NPCH.js";var m=class{_defaultMatcher;ngControl;_parentFormGroup;_parentForm;_stateChanges;errorState=!1;matcher;constructor(e,t,r,n,i){this._defaultMatcher=e,this.ngControl=t,this._parentFormGroup=r,this._parentForm=n,this._stateChanges=i}updateErrorState(){let e=this.errorState,t=this._parentFormGroup||this._parentForm,r=this.matcher||this._defaultMatcher,n=this.ngControl?this.ngControl.control:null,i=r?.isErrorState(n,t)??!1;i!==e&&(this.errorState=i,this._stateChanges.next())}};var M=(()=>{class o{isErrorState(t,r){return!!(t&&t.invalid&&(t.touched||r&&r.submitted))}static \u0275fac=function(r){return new(r||o)};static \u0275prov=c({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var f="astro-lenns-db",a="locations",g=1,h=class o{locationsSignal=l([]);locations$=u(()=>this.locationsSignal());constructor(){this.loadAll()}waitForTx(e){return new Promise((t,r)=>{e.oncomplete=()=>t(),e.onerror=()=>r(e.error),e.onabort=()=>r(e.error)})}openDB(){return new Promise((e,t)=>{let r=indexedDB.open(f,g);r.onupgradeneeded=()=>{let n=r.result;n.objectStoreNames.contains(a)||n.createObjectStore(a,{keyPath:"id",autoIncrement:!0})},r.onsuccess=()=>e(r.result),r.onerror=()=>t(r.error)})}async tx(e,t){let n=(await this.openDB()).transaction(a,e);return t(n.objectStore(a)),await this.waitForTx(n)}async saveNewLocation(e){await this.tx("readwrite",t=>t.add(e)),await this.loadAll()}async editLocation(e,t){let n=(await this.openDB()).transaction(a,"readwrite"),i=n.objectStore(a),d=i.get(e);d.onsuccess=()=>{i.put(s(s({},d.result),t))},await this.waitForTx(n),await this.loadAll()}async deleteLocation(e){await this.tx("readwrite",t=>t.delete(e)),await this.loadAll()}async loadAll(){let n=(await this.openDB()).transaction(a,"readonly").objectStore(a).getAll();n.onsuccess=()=>this.locationsSignal.set(n.result)}async shareLocation(e){let t=`https://maps.google.com/?q=${e.latitude},${e.longitude}`,r=e.address?e.address:e.name;navigator.share?navigator.share({title:e.name,text:`Check out this location: ${r}`,url:t}).catch(()=>window.open(t,"_blank")):window.open(t,"_blank")}openInMaps(e){let t=`https://maps.google.com/?q=${e.latitude},${e.longitude}`;window.open(t,"_blank")}async importLocationFromUrl(e){let t=this.extractCoordinates(e);t&&await this.saveNewLocation({name:"Imported location",type:"Other",latitude:t.lat,longitude:t.lng,isDefault:!1,tags:["Imported"]})}extractCoordinates(e){let t=e.match(/q=(-?\d+.\d+),(-?\d+.\d+)/);return t?{lat:parseFloat(t[1]),lng:parseFloat(t[2])}:null}static \u0275fac=function(t){return new(t||o)};static \u0275prov=c({token:o,factory:o.\u0275fac,providedIn:"root"})};export{m as a,M as b,h as c};
